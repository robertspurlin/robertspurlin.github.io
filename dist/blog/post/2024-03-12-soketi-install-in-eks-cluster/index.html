<!DOCTYPE html><html lang="en"><head><meta name="generator" content="React Static"/><title data-react-helmet="true">Robert Spurlin: Blog </title><meta charSet="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5, shrink-to-fit=no"/><link rel="preload" as="script" href="/templates/styles.ac439c71.js"/><link rel="preload" as="script" href="/templates/vendors~main.66236e5b.js"/><link rel="preload" as="script" href="/main.8e8d98fc.js"/><link rel="preload" as="style" href="/styles.21e5e591.css"/><link rel="stylesheet" href="/styles.21e5e591.css"/><link data-react-helmet="true" rel="icon" href="/images/favicon.png"/></head><body><div id="root"><div style="outline:none" tabindex="-1"><header><nav class="py-0 navbar navbar-expand-lg navbar-light"><div class="container-fluid"><a class="navbar-brand py-3" href="/">Robert Spurlin</a><button aria-controls="navbar-nav" type="button" aria-label="Toggle navigation" class="navbar-toggler collapsed"><span class="navbar-toggler-icon"></span></button><div class="navbar-collapse collapse" id="navbar-nav"><div class="ms-auto navbar-nav"><a class="nav-link" href="/projects">Projects</a><a class="nav-link" href="/blog">Blog</a></div></div></div></nav></header><div class="content"><div style="outline:none" tabindex="-1"></div></div><footer><div class="container-fluid"><div class="d-flex justify-content-between row"><div class="text-center col-md-auto col-12"><p>Â© <!-- -->2024<!-- --> Robert Spurlin.</p></div><div class="text-center col-md-auto col-12"><a href="https://www.linkedin.com/in/spurlinrobert" target="_blank"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="linkedin" class="svg-inline--fa fa-linkedin fa-xl me-3" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg></a><a href="https://www.github.com/robertspurlin" target="_blank"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="github-square" class="svg-inline--fa fa-github-square fa-xl me-3" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zM277.3 415.7c-8.4 1.5-11.5-3.7-11.5-8 0-5.4 .2-33 .2-55.3 0-15.6-5.2-25.5-11.3-30.7 37-4.1 76-9.2 76-73.1 0-18.2-6.5-27.3-17.1-39 1.7-4.3 7.4-22-1.7-45-13.9-4.3-45.7 17.9-45.7 17.9-13.2-3.7-27.5-5.6-41.6-5.6-14.1 0-28.4 1.9-41.6 5.6 0 0-31.8-22.2-45.7-17.9-9.1 22.9-3.5 40.6-1.7 45-10.6 11.7-15.6 20.8-15.6 39 0 63.6 37.3 69 74.3 73.1-4.8 4.3-9.1 11.7-10.6 22.3-9.5 4.3-33.8 11.7-48.3-13.9-9.1-15.8-25.5-17.1-25.5-17.1-16.2-.2-1.1 10.2-1.1 10.2 10.8 5 18.4 24.2 18.4 24.2 9.7 29.7 56.1 19.7 56.1 19.7 0 13.9 .2 36.5 .2 40.6 0 4.3-3 9.5-11.5 8-66-22.1-112.2-84.9-112.2-158.3 0-91.8 70.2-161.5 162-161.5S388 165.6 388 257.4c.1 73.4-44.7 136.3-110.7 158.3zm-98.1-61.1c-1.9 .4-3.7-.4-3.9-1.7-.2-1.5 1.1-2.8 3-3.2 1.9-.2 3.7 .6 3.9 1.9 .3 1.3-1 2.6-3 3zm-9.5-.9c0 1.3-1.5 2.4-3.5 2.4-2.2 .2-3.7-.9-3.7-2.4 0-1.3 1.5-2.4 3.5-2.4 1.9-.2 3.7 .9 3.7 2.4zm-13.7-1.1c-.4 1.3-2.4 1.9-4.1 1.3-1.9-.4-3.2-1.9-2.8-3.2 .4-1.3 2.4-1.9 4.1-1.5 2 .6 3.3 2.1 2.8 3.4zm-12.3-5.4c-.9 1.1-2.8 .9-4.3-.6-1.5-1.3-1.9-3.2-.9-4.1 .9-1.1 2.8-.9 4.3 .6 1.3 1.3 1.8 3.3 .9 4.1zm-9.1-9.1c-.9 .6-2.6 0-3.7-1.5s-1.1-3.2 0-3.9c1.1-.9 2.8-.2 3.7 1.3 1.1 1.5 1.1 3.3 0 4.1zm-6.5-9.7c-.9 .9-2.4 .4-3.5-.6-1.1-1.3-1.3-2.8-.4-3.5 .9-.9 2.4-.4 3.5 .6 1.1 1.3 1.3 2.8 .4 3.5zm-6.7-7.4c-.4 .9-1.7 1.1-2.8 .4-1.3-.6-1.9-1.7-1.5-2.6 .4-.6 1.5-.9 2.8-.4 1.3 .7 1.9 1.8 1.5 2.6z"></path></svg></a><a href="mailto:robertspurlin1996@gmail.com" target="_blank"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="square-envelope" class="svg-inline--fa fa-square-envelope fa-xl me-3" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M384 32H64C28.63 32 0 60.63 0 96v320c0 35.38 28.62 64 64 64h320c35.38 0 64-28.62 64-64V96C448 60.63 419.4 32 384 32zM384 336c0 17.67-14.33 32-32 32H96c-17.67 0-32-14.33-32-32V225.9l138.5 69.27C209.3 298.5 216.6 300.2 224 300.2s14.75-1.688 21.47-5.047L384 225.9V336zM384 190.1l-152.8 76.42c-4.5 2.25-9.812 2.25-14.31 0L64 190.1V176c0-17.67 14.33-32 32-32h256c17.67 0 32 14.33 32 32V190.1z"></path></svg></a></div></div></div></footer></div></div><script type="text/javascript">window.__routeInfo = JSON.parse("{\"template\":\"__react_static_root__/src/containers/Post\",\"sharedHashesByProp\":{},\"data\":{\"post\":{\"slug\":\"/2024-03-12-soketi-install-in-eks-cluster\",\"date\":\"2024-03-12T00:00:00.000Z\",\"content\":\"\\nSoketi is an open-source WebSockets server that served as a best-alternative compared to Pusher's paid plans for my team's needs at the time of implementing. We needed to handle about 200-300 active connections to the server, which pushed us out of the Sandbox tier that Pusher offers. With the added benefit of using the Pusher Protocol, we could easily integrate Soketi with the application in the same exact way. \\n\\nFortunately, there is a Helm chart that does quite a bit of heavy lifting for you (https://github.com/soketi/charts) - however, we were not able to find any examples of implementing said Helm chart using AWS Load Balancer Controller as a reverse-proxy of sorts. \\n\\nThe flow of traffic that my team was after looked a little bit like this:\\n\\n- User logs into the application/uses the application/whatever,\\n- The application would reach out to a custom domain over SSL (and the certificate would be renewed automatically by the issuer),\\n- The Soketi server would upgrade the connection as appropriate and messages would flow between the application and the server in real time. \\n\\nThe documentation of Soketi mentions the use of a web server to use a custom domain (https://docs.soketi.app/getting-started/backend-configuration/nginx-configuration) but we did not want to manage the certificate or install Nginx on the cluster if it wasn't necessary. What we have on the cluster (and use often), however, is AWS Load Balancer Controller. Using AWS Load Balancer Controller meets the requirement of non-management of the certificate since the Load Balancer handles SSL. \\n\\nThe Helm chart mentioned above encourages changes as necessary to fit your use case, and that's exactly what we did. We enabled the HPA, Ingress, and Network Watcher in the values.yaml file to appropriately handle overloaded pods without dropping channel connections. \\n\\nHowever, small modifications were needed to the Ingress to make everything work. Below is how the Ingress looks when you download the chart - \\n\\n```\\ningress:\\n  enabled: false\\n  # class: \\\"nginx\\\"\\n  annotations: {}\\n    # kubernetes.io/ingress.class: nginx\\n    # kubernetes.io/tls-acme: \\\"true\\\"\\n  hosts:\\n    - host: soketi-example.local\\n      paths: []\\n\\n    # - host: soketi.test\\n    #   paths:\\n    #     - /\\n  tls: []\\n  #  - secretName: soketi-example-tls\\n  #    hosts:\\n  #      - soketi-example.local\\n```\\n\\nIt's apparant that in testing of this chart, the Nginx Ingress Controller was used - we will modify the `class` to use `\\\"alb\\\"` and add our specific annotations as appropriate via the values.yaml file.\\n\\n```\\ningress:\\n  enabled: true\\n  class: \\\"alb\\\"\\n  annotations:\\n    alb.ingress.kubernetes.io/backend-protocol: HTTP\\n    alb.ingress.kubernetes.io/load-balancer-name: # the name of the LB that is going to be created\\n    alb.ingress.kubernetes.io/certificate-arn: # your certificate ARN here\\n    alb.ingress.kubernetes.io/inbound-cidrs: # your inbound CIDRs here\\n    alb.ingress.kubernetes.io/ssl-policy: # your SSL policy name here\\n    alb.ingress.kubernetes.io/scheme: internet-facing\\n    alb.ingress.kubernetes.io/subnets: # your subnets here\\n    alb.ingress.kubernetes.io/target-type: ip\\n    alb.ingress.kubernetes.io/listen-ports: '[{\\\"HTTP\\\": 80}, {\\\"HTTPS\\\":443}, {\\\"HTTP\\\": 6001}, {\\\"HTTPS\\\": 6002}]'\\n    alb.ingress.kubernetes.io/ssl-redirect: '443' \\n\\n    # Health checks\\n    alb.ingress.kubernetes.io/healthcheck-port: '6001'\\n    alb.ingress.kubernetes.io/healthcheck-path: /accept-traffic # Already used as a readinessProbe\\n    alb.ingress.kubernetes.io/success-codes: '200'\\n```\\n\\nThe final modification to the Ingress is to add the hosts and paths as appropriate (confirm that the templates will read the values appropriately). Note that only one path - `/app/app-key` - is defined. The Soketi server will upgrade the connection on successful authenication. \\n\\n```\\n  hosts:\\n  - host: # your host name here\\n    paths:\\n      - /app/app-key\\n```\\n\\nOne final modification that we made to the Helm chart is the addition of an ExternalSecret to pass the `SOKETI_DEFAULT_APP_ID`, `SOKETI_DEFAULT_APP_KEY`, and `SOKETI_DEFAULT_APP_SECRET` to the pod - the Soketi server already listens for said env variables to configure on run. \\n\\n\",\"data\":{\"title\":\"Installing Soketi on an EKS Cluster with AWS Load Balancer Controller\",\"thumbnail_path\":\"/images/blog/soketi.png\"},\"isEmpty\":false,\"excerpt\":\"\",\"path\":\"src/content/posts/2024-03-12-soketi-install-in-eks-cluster.md\"}},\"path\":\"blog/post/2024-03-12-soketi-install-in-eks-cluster\",\"sharedData\":{},\"siteData\":{}}");</script><script defer="" type="text/javascript" src="/templates/styles.ac439c71.js"></script><script defer="" type="text/javascript" src="/templates/vendors~main.66236e5b.js"></script><script defer="" type="text/javascript" src="/main.8e8d98fc.js"></script></body></html>