<!DOCTYPE html><html lang="en"><head><meta name="generator" content="React Static"/><title data-react-helmet="true">Robert Spurlin: Blog </title><meta charSet="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5, shrink-to-fit=no"/><link rel="preload" as="script" href="/templates/styles.ac439c71.js"/><link rel="preload" as="script" href="/templates/vendors~main.66236e5b.js"/><link rel="preload" as="script" href="/main.8e8d98fc.js"/><link rel="preload" as="style" href="/styles.21e5e591.css"/><link rel="stylesheet" href="/styles.21e5e591.css"/><link data-react-helmet="true" rel="icon" href="/images/favicon.png"/></head><body><div id="root"><div style="outline:none" tabindex="-1"><header><nav class="py-0 navbar navbar-expand-lg navbar-light"><div class="container-fluid"><a class="navbar-brand py-3" href="/">Robert Spurlin</a><button aria-controls="navbar-nav" type="button" aria-label="Toggle navigation" class="navbar-toggler collapsed"><span class="navbar-toggler-icon"></span></button><div class="navbar-collapse collapse" id="navbar-nav"><div class="ms-auto navbar-nav"><a class="nav-link" href="/projects">Projects</a><a aria-current="page" class="nav-link active" href="/blog">Blog</a></div></div></div></nav></header><div class="content"><div style="outline:none" tabindex="-1"><div class="blog"><div class="container-fluid"><div class="bg-light no-gutters border py-5 row"><div class="text-center col-12"><h1>Blog</h1><p class="mt-3">My thoughts, now on the internet.</p></div></div></div><div class="small-container container"><article class="my-5"><div class="row"><div class="text-center mb-3 col-md-4 col-12"><a href="/blog/post/2024-03-12-soketi-install-in-eks-cluster/"><img src="/images/blog/soketi.png" class="img-fluid"/></a></div><div class="col-md-8 col-12"><a href="/blog/post/2024-03-12-soketi-install-in-eks-cluster/"><h2>Installing Soketi on an EKS Cluster with AWS Load Balancer Controller</h2></a><p>March 12, 2024</p><p>
Soketi is an open-source WebSockets server that served as a best-alternative compared to Pusher&#x27;s paid plans for my team&#x27;s needs at the time of implementing. We needed to han...</p><a href="/blog/post/2024-03-12-soketi-install-in-eks-cluster/">Continue Reading &gt;</a></div><div class="mt-5 mb-3 col-12"><hr/></div></div></article><article class="my-5"><div class="row"><div class="text-center mb-3 col-md-4 col-12"><a href="/blog/post/2022-03-15-portfolio-rebuild-in-react/"><img src="/images/blog/react.png" class="img-fluid"/></a></div><div class="col-md-8 col-12"><a href="/blog/post/2022-03-15-portfolio-rebuild-in-react/"><h2>Portfolio Rebuild in React</h2></a><p>March 15, 2022</p><p>
One lonely weekend, I decided that I should probably update my personal site to be a bit more current. Long story short, I rebuilt the entire thing in React using React Stati...</p><a href="/blog/post/2022-03-15-portfolio-rebuild-in-react/">Continue Reading &gt;</a></div><div class="mt-5 mb-3 col-12"><hr/></div></div></article><article class="my-5"><div class="row"><div class="text-center mb-3 col-md-4 col-12"><a href="/blog/post/2020-05-02-high-availability-wordpress-sites-within-aws/"><img src="/images/blog/wordpress.png" class="img-fluid"/></a></div><div class="col-md-8 col-12"><a href="/blog/post/2020-05-02-high-availability-wordpress-sites-within-aws/"><h2>High Availability WordPress Websites Within AWS</h2></a><p>May 2, 2020</p><p>
The best way to learn something deeply is to try to teach it. So, here is my attempt to provide a crude guideline on how to set up a high-availibility WordPress site. This po...</p><a href="/blog/post/2020-05-02-high-availability-wordpress-sites-within-aws/">Continue Reading &gt;</a></div><div class="mt-5 mb-3 col-12"><hr/></div></div></article><article class="my-5"><div class="row"><div class="text-center mb-3 col-md-4 col-12"><a href="/blog/post/2017-08-04-react-tic-tac-toe-algorithms-oh-my/"><img src="/images/blog/algorithm.jpeg" class="img-fluid"/></a></div><div class="col-md-8 col-12"><a href="/blog/post/2017-08-04-react-tic-tac-toe-algorithms-oh-my/"><h2>React, Tic-Tac-Toe, and Algorithms, oh my!</h2></a><p>August 4, 2017</p><p>
I was in a developer&#x27;s meeting at my internship (Titan Web Marketing Solutions) about a week or so ago. We were talking about interactive dashboards 
and I voiced up and told...</p><a href="/blog/post/2017-08-04-react-tic-tac-toe-algorithms-oh-my/">Continue Reading &gt;</a></div><div class="mt-5 mb-3 col-12"><hr/></div></div></article></div></div></div></div><footer><div class="container-fluid"><div class="d-flex justify-content-between row"><div class="text-center col-md-auto col-12"><p>Â© <!-- -->2024<!-- --> Robert Spurlin.</p></div><div class="text-center col-md-auto col-12"><a href="https://www.linkedin.com/in/spurlinrobert" target="_blank"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="linkedin" class="svg-inline--fa fa-linkedin fa-xl me-3" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg></a><a href="https://www.github.com/robertspurlin" target="_blank"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="github-square" class="svg-inline--fa fa-github-square fa-xl me-3" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zM277.3 415.7c-8.4 1.5-11.5-3.7-11.5-8 0-5.4 .2-33 .2-55.3 0-15.6-5.2-25.5-11.3-30.7 37-4.1 76-9.2 76-73.1 0-18.2-6.5-27.3-17.1-39 1.7-4.3 7.4-22-1.7-45-13.9-4.3-45.7 17.9-45.7 17.9-13.2-3.7-27.5-5.6-41.6-5.6-14.1 0-28.4 1.9-41.6 5.6 0 0-31.8-22.2-45.7-17.9-9.1 22.9-3.5 40.6-1.7 45-10.6 11.7-15.6 20.8-15.6 39 0 63.6 37.3 69 74.3 73.1-4.8 4.3-9.1 11.7-10.6 22.3-9.5 4.3-33.8 11.7-48.3-13.9-9.1-15.8-25.5-17.1-25.5-17.1-16.2-.2-1.1 10.2-1.1 10.2 10.8 5 18.4 24.2 18.4 24.2 9.7 29.7 56.1 19.7 56.1 19.7 0 13.9 .2 36.5 .2 40.6 0 4.3-3 9.5-11.5 8-66-22.1-112.2-84.9-112.2-158.3 0-91.8 70.2-161.5 162-161.5S388 165.6 388 257.4c.1 73.4-44.7 136.3-110.7 158.3zm-98.1-61.1c-1.9 .4-3.7-.4-3.9-1.7-.2-1.5 1.1-2.8 3-3.2 1.9-.2 3.7 .6 3.9 1.9 .3 1.3-1 2.6-3 3zm-9.5-.9c0 1.3-1.5 2.4-3.5 2.4-2.2 .2-3.7-.9-3.7-2.4 0-1.3 1.5-2.4 3.5-2.4 1.9-.2 3.7 .9 3.7 2.4zm-13.7-1.1c-.4 1.3-2.4 1.9-4.1 1.3-1.9-.4-3.2-1.9-2.8-3.2 .4-1.3 2.4-1.9 4.1-1.5 2 .6 3.3 2.1 2.8 3.4zm-12.3-5.4c-.9 1.1-2.8 .9-4.3-.6-1.5-1.3-1.9-3.2-.9-4.1 .9-1.1 2.8-.9 4.3 .6 1.3 1.3 1.8 3.3 .9 4.1zm-9.1-9.1c-.9 .6-2.6 0-3.7-1.5s-1.1-3.2 0-3.9c1.1-.9 2.8-.2 3.7 1.3 1.1 1.5 1.1 3.3 0 4.1zm-6.5-9.7c-.9 .9-2.4 .4-3.5-.6-1.1-1.3-1.3-2.8-.4-3.5 .9-.9 2.4-.4 3.5 .6 1.1 1.3 1.3 2.8 .4 3.5zm-6.7-7.4c-.4 .9-1.7 1.1-2.8 .4-1.3-.6-1.9-1.7-1.5-2.6 .4-.6 1.5-.9 2.8-.4 1.3 .7 1.9 1.8 1.5 2.6z"></path></svg></a><a href="mailto:robertspurlin1996@gmail.com" target="_blank"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="square-envelope" class="svg-inline--fa fa-square-envelope fa-xl me-3" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M384 32H64C28.63 32 0 60.63 0 96v320c0 35.38 28.62 64 64 64h320c35.38 0 64-28.62 64-64V96C448 60.63 419.4 32 384 32zM384 336c0 17.67-14.33 32-32 32H96c-17.67 0-32-14.33-32-32V225.9l138.5 69.27C209.3 298.5 216.6 300.2 224 300.2s14.75-1.688 21.47-5.047L384 225.9V336zM384 190.1l-152.8 76.42c-4.5 2.25-9.812 2.25-14.31 0L64 190.1V176c0-17.67 14.33-32 32-32h256c17.67 0 32 14.33 32 32V190.1z"></path></svg></a></div></div></div></footer></div></div><script type="text/javascript">window.__routeInfo = JSON.parse("{\"template\":\"__react_static_root__/src/pages/blog.js\",\"sharedHashesByProp\":{},\"data\":{\"posts\":[{\"slug\":\"/2024-03-12-soketi-install-in-eks-cluster\",\"date\":\"2024-03-12T00:00:00.000Z\",\"content\":\"\\nSoketi is an open-source WebSockets server that served as a best-alternative compared to Pusher's paid plans for my team's needs at the time of implementing. We needed to handle about 200-300 active connections to the server, which pushed us out of the Sandbox tier that Pusher offers. With the added benefit of using the Pusher Protocol, we could easily integrate Soketi with the application in the same exact way. \\n\\nFortunately, there is a Helm chart that does quite a bit of heavy lifting for you (https://github.com/soketi/charts) - however, we were not able to find any examples of implementing said Helm chart using AWS Load Balancer Controller as a reverse-proxy of sorts. \\n\\nThe flow of traffic that my team was after looked a little bit like this:\\n\\n- User logs into the application/uses the application/whatever,\\n- The application would reach out to a custom domain over SSL (and the certificate would be renewed automatically by the issuer),\\n- The Soketi server would upgrade the connection as appropriate and messages would flow between the application and the server in real time. \\n\\nThe documentation of Soketi mentions the use of a web server to use a custom domain (https://docs.soketi.app/getting-started/backend-configuration/nginx-configuration) but we did not want to manage the certificate or install Nginx on the cluster if it wasn't necessary. What we have on the cluster (and use often), however, is AWS Load Balancer Controller. Using AWS Load Balancer Controller meets the requirement of non-management of the certificate since the Load Balancer handles SSL. \\n\\nThe Helm chart mentioned above encourages changes as necessary to fit your use case, and that's exactly what we did. We enabled the HPA, Ingress, and Network Watcher in the values.yaml file to appropriately handle overloaded pods without dropping channel connections. \\n\\nHowever, small modifications were needed to the Ingress to make everything work. Below is how the Ingress looks when you download the chart - \\n\\n```\\ningress:\\n  enabled: false\\n  # class: \\\"nginx\\\"\\n  annotations: {}\\n    # kubernetes.io/ingress.class: nginx\\n    # kubernetes.io/tls-acme: \\\"true\\\"\\n  hosts:\\n    - host: soketi-example.local\\n      paths: []\\n\\n    # - host: soketi.test\\n    #   paths:\\n    #     - /\\n  tls: []\\n  #  - secretName: soketi-example-tls\\n  #    hosts:\\n  #      - soketi-example.local\\n```\\n\\nIt's apparant that in testing of this chart, the Nginx Ingress Controller was used - we will modify the `class` to use `\\\"alb\\\"` and add our specific annotations as appropriate via the values.yaml file.\\n\\n```\\ningress:\\n  enabled: true\\n  class: \\\"alb\\\"\\n  annotations:\\n    alb.ingress.kubernetes.io/backend-protocol: HTTP\\n    alb.ingress.kubernetes.io/load-balancer-name: # the name of the LB that is going to be created\\n    alb.ingress.kubernetes.io/certificate-arn: # your certificate ARN here\\n    alb.ingress.kubernetes.io/inbound-cidrs: # your inbound CIDRs here\\n    alb.ingress.kubernetes.io/ssl-policy: # your SSL policy name here\\n    alb.ingress.kubernetes.io/scheme: internet-facing\\n    alb.ingress.kubernetes.io/subnets: # your subnets here\\n    alb.ingress.kubernetes.io/target-type: ip\\n    alb.ingress.kubernetes.io/listen-ports: '[{\\\"HTTP\\\": 80}, {\\\"HTTPS\\\":443}, {\\\"HTTP\\\": 6001}, {\\\"HTTPS\\\": 6002}]'\\n    alb.ingress.kubernetes.io/ssl-redirect: '443' \\n\\n    # Health checks\\n    alb.ingress.kubernetes.io/healthcheck-port: '6001'\\n    alb.ingress.kubernetes.io/healthcheck-path: /accept-traffic # Already used as a readinessProbe\\n    alb.ingress.kubernetes.io/success-codes: '200'\\n```\\n\\nAnother modification to the Ingress is to add the hosts and paths as appropriate (confirm that the templates will read the values appropriately). Note that only one path - `/app/app-key` - is defined. The Soketi server will upgrade the connection on successful authenication. \\n\\n```\\n  hosts:\\n  - host: # your host name here\\n    paths:\\n      - /app/app-key\\n```\\n\\nOne final modification that we made to the Helm chart is the addition of an ExternalSecret to pass the `SOKETI_DEFAULT_APP_ID`, `SOKETI_DEFAULT_APP_KEY`, and `SOKETI_DEFAULT_APP_SECRET` to the pod - the Soketi server already listens for said env variables to configure on run. \\n\\n\",\"data\":{\"title\":\"Installing Soketi on an EKS Cluster with AWS Load Balancer Controller\",\"thumbnail_path\":\"/images/blog/soketi.png\"},\"isEmpty\":false,\"excerpt\":\"\",\"path\":\"src/content/posts/2024-03-12-soketi-install-in-eks-cluster.md\"},{\"slug\":\"/2022-03-15-portfolio-rebuild-in-react\",\"date\":\"2022-03-15T00:00:00.000Z\",\"content\":\"\\nOne lonely weekend, I decided that I should probably update my personal site to be a bit more current. Long story short, I rebuilt the entire thing in React using React Static.\\n\\nWhy? Mainly because I wanted to prove to myself that I actually can build pretty good looking things in React, and I felt that my previous personal site was a bit too complicated for my tastes.\\n\\nI knew that I only wanted two parts for my website - a blog and a small portion for my work that I wanted to highlight. I'm not saying that the other site did not do that well, but it did _so much more_ than I was ever willing to use it for. \\n\\nSo, I brought over my posts (that were already written in Markdown), the collection of my Projects (in a YAML file), and set off to see if I can actually do this in a timely manner.\\n\\nSince I already have professional experience writing production-level code in Vue, I was already aware of the concepts of a data-driven modern front end, and had a general idea on how I wanted things to work. The rest of my issues were mainly React Static related, since the _magic sauce_ is it's autocompilation of routes to something a webhost that is free and has no back end compilation (cough, GitHub Pages) can read without major headaches. Once I figured out how to read all files in a directory (thanks, FS!), the rest was just wrangling of it's contents (using gray-matter to read the file) to something that I can feed to Page Components and loop through accordingly.\\n\\nAnd that I did. All data is being handled and precompiled by React Static, and I access the data in a very familiar way (cough, state) and build out what I needed to.\\n\\nThis was a good exercise in what I can accomplish given enough brain power, and made me feel quite a lot better about my website, knowing that I built it from the ground up and if something breaks, I can (probably) fix it. \\n\\nI also find that data-driven front end development is a sweet middle ground between what I like doing - wrangling with data to make it usable, and making things look and feel good to users. And the rebuild was a great exercise in both - looking at the data and how it is structured, how I wanted it to be structured, and how it should look to the user once fed to components properly.\\n\",\"data\":{\"title\":\"Portfolio Rebuild in React\",\"thumbnail_path\":\"/images/blog/react.png\"},\"isEmpty\":false,\"excerpt\":\"\",\"path\":\"src/content/posts/2022-03-15-portfolio-rebuild-in-react.md\"},{\"slug\":\"/2020-05-02-high-availability-wordpress-sites-within-aws\",\"date\":\"2020-05-02T00:00:00.000Z\",\"content\":\"\\nThe best way to learn something deeply is to try to teach it. So, here is my attempt to provide a crude guideline on how to set up a high-availibility WordPress site. This post assumes -\\n\\n1. That you have an active Amazon Web Services account,\\n2. that you are familiar with how to use the Amazon Web Services dashboard,\\n3. that you are vaguely familiar with how to create an EC2 and RDS instance of your choice,\\n4. that you understand the basic concepts on how a WordPress site works and how to host one, \\n5. and that you will research deeper a concept or technology that you don't understand before you implement it.\\n\\n**DISCLAIMER**\\n\\nI am not responsible for any damages and or charges incurred. This setup may and will most likely be expensive, and can inflate your AWS bill. This advice is brought to you as-is without any guarantee. Do not do **anything** in AWS without understanding the costs and or ramifications of what you are about to do. Use at your own risk!\\n\\nAlso, these opinions included in this article are none other than my own. Again, *please* use this article at your own risk - I am not responsible for any damages or costs incurred. \\n\\n---\\n\\nAbout the concept of 'high availability' WordPress sites - for the purposes of this post, 'high availability' means a website that can handle hundreds of thousands of requests at any given time without any downtime or hiccups, and that the website will adjust it's resources available to ensure uptime. \\n\\nTo understand the concept, let's consider a situation where one website is being served by one server. No matter how large the server is and how many resources it has, the number of resources that the server will always be fixed (exceptions being if you upgrade the server). Theoretically, the server will only be able to serve a certain amount of requests at any given time before there are no more resources to allocate and the website 'crashes'. If there was a way to adjust the amount of resources a server has based on some metric, i.e. average CPU usage and/or incoming traffic, then we can ensure 100% uptime no matter the amount of requests coming in. \\n\\nFortunately, AWS makes this possible by using Auto Scaling groups. An Auto Scaling group usually has instructions to spin up (scale up) and/or terminate (scale down) EC2 instances based on some metric. It is also more cost effective to use Auto Scaling groups, compared to have x amount of servers running at all times regardless of traffic. \\n\\nSpecifically, here is what will need to be set up for a WordPress instance to have as high availibility as possible - \\n\\n1. An EC2 instance set up to serve a WordPress site (size is up to you - it is only needed to create an AMI image),\\n2. An Auto Scaling group and Launch Configuration, \\n3. An RDS instance to serve the WordPress database (MySQL is needed for WordPress),\\n4. An EFS system so the EC2 instances can share the wp-uploads directory (S3 can be used here too, but I prefer EFS because it is NFS friendly), \\n5. An Elastic Load Balancer (I recommend the Network type),\\n6. A distribution in CloudFront for CDN/cache purposes. \\n\\nHere is my experience with setting up a system like this - \\n\\nSet up the EC2 and RDS instance first, and install the WordPress site where WordPress is pointing at the RDS instance. If you are using a SSL certificate (and I recommend that you should), make sure the server is ready and capable to serve insecure (port 80) and secure (port 443) requests. \\n\\nThen, create an EFS instance and make sure that the EC2 instance can communicate with the EFS instance (see recommended Security Groups for communication between EC2 and EFS in AWS docs). Once everything is installed, mount the EFS instance where the wp-uploads directory would be and make sure that the EFS instance mounts every time the EC2 instance boots. \\n\\nHere, I also installed a script that checks the repository of the WordPress site and pulls down if there is something new that runs every minute. This way, the EC2 instances will stay up to date and in sync with each other. \\n\\nWhen everything is set up accordingly with the WordPress site, create an AMI Image of the EC2 instance. The Launch Configuration will use this image. \\n\\nThen, create the Elastic Load Balancer. If you want to see it work, attach the EC2 instance to the Load Balancer and try to make a request to it. I would take your SSL certificate for the website and have the Load Balancer serve it, to solve some SSL headaches that might happen. \\n\\nNext, create the Launch Configuration. The Launch Configuration is what the Auto Scaling group will use to spin up new EC2 instances. Set up the Launch Configuration to use the EC2 image you created, in whatever size EC2 instances you choose.\\n\\nThen, create the Auto Scaling group, and set it up to use the Launch Configuration you just created. Decide the minimum (1 at the least), the maximum, and the preferred amount of instances it should have, and what metric it should use to create and or terminate instances (I used average CPU, but you can also use the amount of traffic coming in to the load balancer). Make sure that it is set up to create the EC2 instance within the Load Balancer. \\n\\nAs soon as the Auto Scaling group is created, it will create a new EC2 instance based on the instructions within the Launch Configuration. It will also create (at least) two new alarms within CloudWatch - do not delete or edit them, as it is how the Auto Scaling group decides what to do. \\n\\nIf everything is set up correctly, the new EC2 instance will be a perfect clone of the one you set up earlier and will already be in the Load Balancer (or will be in the process of being checked by the Load Balancer). \\n\\nLastly, we need to configure the CDN. Set up a new distribution, use your settings and behaviors of choice, and have the origin be the Load Balancer. Configure the domain to point to the CDN. \\n\\nMy suggestion would be to have everything under the wp-admin/ and the wp-includes/ directory uncached, and to have everything else cached for a minimum of an hour. \\n\\n(If you don't use any domain provider yet and/or haven't bought the domain yet, I recommend AWS's Route 53 for attachments to load balancers and or CDN's. It has an A record ALIAS feature that solves the issue of the CDN cycling through different IP addresses. If you don't have Route 53, that's okay - just point the www. CNAME to the CDN, and have the A @ record point somewhere that can redirect to the www. One way is to set up one of the EC2 instances within the Auto Scaling group to be protected from scaling in, allocate an elastic IP to the EC2 instance, and point the A record there. This setup may put extra stress on that server in peak traffic, FYI...)\\n\\nDone! You now have a lean, mean, WordPress machine that can handle a good amount of requests without breaking a sweat. You can now suspend or terminate the EC2 instance you created in the beginning (to create the image).\\n\\nA couple of notes here - \\n\\nI set up the WordPress URL with the https://, so that if WordPress recieves an insecure request, it will try to redirect. My suggestion would be to redirect all insecure requests via the CDN so it doesn't redirect to iself as well.\\n\\nYou can set up alarms that will alert you when the Auto Scaling group scales in, out, or has an error. I suggest you do so. \\n\\nAgain, I am not responsible for any damages and or charges incurred. This advice is brought to you as-is without any guarantee. Use at your own risk!\\n\\nIn closing, AWS makes it pretty simple to have a high-availibility WordPress site that can handle an ubsurd amount of requests. I hope that this gives some guidance to people trying to find long-term WordPress infrastructure solutions.\\n\",\"data\":{\"title\":\"High Availability WordPress Websites Within AWS\",\"thumbnail_path\":\"/images/blog/wordpress.png\"},\"isEmpty\":false,\"excerpt\":\"\",\"path\":\"src/content/posts/2020-05-02-high-availability-wordpress-sites-within-aws.md\"},{\"slug\":\"/2017-08-04-react-tic-tac-toe-algorithms-oh-my\",\"date\":\"2017-08-04T00:00:00.000Z\",\"content\":\"\\nI was in a developer's meeting at my internship (Titan Web Marketing Solutions) about a week or so ago. We were talking about interactive dashboards \\nand I voiced up and told everyone that I have seen it done with React. The catch-  I could barely understand how it was built. I keep hearing about React and have seen projects built with it, but it was still very foreign to me. A Developer was reading up on the docs for React after the meeting and found a walk-through tutorial for a very simple tic-tac-toe game. It wasn't pretty, but the whole point was to at least grasp a little bit of React. \\n\\nHere is a link to the tutorial: [https://facebook.github.io/react/tutorial/tutorial.html](https://facebook.github.io/react/tutorial/tutorial.html) \\n\\nSo I took a shot at it over the weekend and got it running on localhost thanks to node.js and React's boilerplate (react-create-app). My first real React app! \\n\\nWhen I saw it running with the React Inspector add on for Chrome lit up (indicating that it was a React app), it sure was satisfying. \\n\\nIt was missing something, though. Well, three things.\\n\\n1.  You couldn't clear the board after the game is over,\\n2.  You couldn't choose what player you wanted to play as,\\n3.  You were playing against yourself (no computer intervention). Not that fun.\\n\\nDid I get it to do what I wanted to? Yes, but not after a couple of struggles. See the app in action here: [https://robertspurlin.github.io/tic-tac-toe](https://robertspurlin.github.io/tic-tac-toe) \\n_Hold on there, man. I'm not even sure why you would do this in React. Why not just good ol' Javascript?_ \\nThere is nothing wrong with vanilla javascript, and in fact, that's how I would of built the app initially if it weren't for this tutorial. \\nB\\nut I wanted to push myself. I wanted to understand why React was so popular. \\n\\nThe tutorial (above) provides you two choices: to code in your browser in an environment like Codepen, or to do it locally. I chose locally, and the tutorial even has a little bit of a walkthrough for doing that as well. I did it exactly like the tutorial recommended and it worked like a charm. \\nHere's how I got it started: Downloaded the newest version of node.js - can be found on their website.  \\nDon't know if you have node installed already? Open up Terminal/iTerm and run `node -v` \\n\\nWent into the directory that I wanted the app the be in (in Terminal/iTerm) and ran `npm install -g create-react-app` (this installs that boilerplate that I was talking about. If it doesn't work on first try like it didn't with me, try running it again with `sudo` in front of it. It will ask for your administrative password of your computer. \\n\\nAfter it was done, I called create-react-app with whatever I wanted the name of the project to be (I chose tic-tac-toe) - `create-react-app tic-tac-toe` \\n\\nIt creates the tic-tac-toe directory for you after it is finished with the files to start out. When it's done, I went into the new directory that create-react-app made so nicely for me (`cd tic-tac-toe`) \\n\\nFinally, I ran `npm start`. When that was finished, my browser opened with localhost:3000 as the URL, and a starter page popped up. It's alive! Here is the code for the whole project. \\n\\nIt'll probably be easier if you [follow along.](https://github.com/robertspurlin/tic-tac-toe/blob/master/src/index.js) The instructions for making this game are found in the tutorial and are well-written. \\n\\nIf you have finished it and want to follow along, great! If you still want to follow along but haven't built the app, I suggest you start there. If you follow the tutorial that React gives you, you will end up with something like [this](https://codepen.io/gaearon/pen/gWWZgR?editors=0010). \\n\\nI stopped at where the game was fully functional and deleted all the history code. It was fine and all, but I just wanted the game. Let's get cracking on those problems that I had with the game. \\n\\nProblem 1- you couldn't clear the board after the game was over. You just need like a button or something that appears after the game is over. \\n\\nSo I added another div element with only the variable `{button}` in board's return call in it's render function (right below the status). I figured that the variable would be empty until the game is over, right? There is an if test that tests for the winner right above the return() call that changes `status` when the game is over. So, let's initialize `button` with `status`. And when the game is over, set button to a JSX element (that isn't defined yet) that calls this.resetClick() (also not defined). So let's define button that accepts onClick. I just put it on top of the file, where `Square` is defined. onClick is coming from the parent of Button via props, and Button is being called with this.resetClick(). **Important:** this.resetClick() needs to be in Board. Why? Because resetClick() changes the state of the Board with setState. You can't do that outside of Board. I set the squares to just an empty array. It'll work with the rest of the components. So let's recap. the variable button appears with a JSX element when the game is over. That JSX element has an onClick call to a function that changes the state of the board (clearing the board).\\n\\nNext! \\n\\n2\\\\. You couldn't choose what player you want to be. \\n\\nLet's take a look at Game (not Board). It just renders Board, right? What if we changed it to render another variable? What I did was that I added a contructor function in Game that will initialize the state (because Game is a React.Component, it is able to do so). Let's say that hasChosen (a name that I made up) is set to false on initialization of Game. Makes sense. We also need to create another state in this function that will tell Board who is who. I created another state named isX, and it honestly doesn't matter what we set to (true or false, or even null). Just as long as it is able to tell Board who is who at the end of the day. I set mine to true just because. In the render function of Game, lets create a variable (I named mine board) that changes based on what hasChosen is. I made two buttons that both have another onClick function that will change the state of Game when called. In render, I am testing on whether hasChosen is true or false. It hasChosen is false, the variable is set to call Question(), which returns the two buttons with the question \\\"X or O?\\\". Both buttons have an onClick argument that calls a function which takes a boolean as an argument and are appropriately filled with \\\"X\\\" and \\\"O\\\". If hasChosen is true, the variable is set to render Board. Let's think about this. We have two buttons now that calls another function (for those following along, it's test(bool)). We want that function to change the state of the board. But what will tell the board who is who? Enter isX. I have the onClick function to accept a boolean. If that boolean is true (therefore meaning that isX is true), it sets the state to hasChosen:true (rendering the board) and isX:true (which will tell the board that the human is X and the computer is O). Likewise, if that boolean is false, it sets the state to hasChosen:true (still rendering the board), but with isX: false. Great. Now the last thing to do is tell Board who is who. Let's set up Board to take props (just have to change constructor() and super() to constructor(props) and super(props)). If we look at the constructor, it has xIsNext, which tells the board what player will go first (it is set to true). Change it to props.isX, so it will take the decision from Game and set it to Board. You should be able to choose what player you want to play now. \\n\\nNext! \\n\\n3\\\\. You were playing against yourself (no computer intervention). Not that fun. \\n\\nThis is the hardest one. I implemented the first two fixes in about two hours, and was stumped at this one. How would I be able to do this? Where there is a will, there is a way, right? Let me say before we start that I have a function in this game that I can call at any time that will return a copy of the board. This will become useful when the computer is considering possible moves. As a general rule, you should make copies of what you are working on so if it becomes screwed up, not a big deal at all. Let's start by defining who is who (human or computer). I put the definition in handleClick of the squares, and it decides who is who based on the state of board. (Note: not a const variable because every time you click on the squares, this.state.xIsNext has been reverted back by a function that we will cover later) `computer = this.state.xIsNext ? 'O' : 'X'; human = this.state.xIsNext ? 'X' : 'O';` Let's look at handleClick while we are here. Tests for a winner, and if not, sets the index of the Board (array), changes the board, and changes the player. If only I can call a function in that setState without breaking anything. Surprise! You can, but as a callback in setState. Example: `this.setState({squares: squares,xIsNext: !this.state.xIsNext,},this.AIDecider);` It just needs to be referenced after the curly cues end. \\n\\n_Hold on, what is AIDecider?_\\n\\n Glad you asked. Think of it as the waiter, and Board is a food blogger with a good following that is looking for any reason to tear this place up. Board wants something, and AIDecider will bring it to Board (by using setState). AIDecider doesn't do the cooking, but is still a major important part of the restaurant. For example, if one of the cooks gives it something that looks or tastes bad (maybe there is an error, or maybe the customer is allergic to something in the dish), the waiter will catch that and won't give it to the customer (unless the cooks give AIDecider something even worse at the end of the move). It wants to give the food blogger the best that the cooks can offer. Same thing with Board and AIDecider. The cooks bring back a value, and AIDecider decides which is the best one to give to Board. We will get to who does the cooking later. AIDecider has a loop in it that runs until the number of times it will run is larger than the board itself. Or, in code terms, `for (let i = 0; i < boardCopy.length; i++)` The first thing that is needed for this to work is a function that returns a board with a possible move. If the actual board itself is nothing other than an array, then we can run i through this function. What this function has to do is make sure that what AIDecider gave it is even possible. If it is, then return the board to AIDecider so it can be determined whether it is a good move or not (by the cooks). So. Let's make this function accept three arguments. The index that AIDecider is looping through at that point in time, the player in question so it knows what to put into the array if it is valid, and a copy of the board. I named this function validMove. The first thing that validMove does is take a copy of the board thanks to the handy dandy board copier function and stores it in a variable. Then, it makes sure that the index that it is given is an okay move to make. If it is, return the board. If not, return null. \\n\\n Now that we have that under control, let's go back to AIDecider. It calls validMove and returns either a board or null. If a board is returned, then it sends the boards to one of the cooks where it will talk with the other cook in the back and make sure that it is a good move or not. This is where the MiniMax algorithm comes in. The basic premise is that it is testing for the best possible situation based on the given board. \\n\\n It works a little bit like this: _Hey there, minScore AKA my coworker, AIDecider gave me a board and wants to know if it's good. Before I, maxScore, ask for your opinion, I want to make sure. No hard feelings, right bro?_ \\n\\n So maxScore has three tests before it calls minScore. The first test is to make sure that the board given is a winning board. Who wins, you ask? It tests for if the computer wins if this board is played. If so, return a nice number. I'm thinking 10. The second test is testing for the opposite (if the board results in a winning board for the human). This one returns -10 if its true. The third and last one tests for if the board results in a tie. If so, return 0. Recap: Computer wins, yay! 10 points. Tie, meh. 0 points. Lose, bad. -10 points. But what if the board that maxScore gets is incomplete? What if the board doesn't result in a win, loss, or tie at all? Well, what maxScore does is that it adds a possible move on top of the move that AIDecider is considering and sends that board (with the extra move) to validMove. If validMove gives maxScore it's blessing, it needs to test again if the board will result in a win/loss/tie/what have you. \\n\\n _Note: the computer is now thinking two moves ahead if maxScore adds on a move. _ But how can maxScore determine whether it is a good move or not? It's already tested a board once, and adds a move as a last resort (in the else argument in the if statement). That's when it calls minScore. minScore has the same exact tests that maxScore does. minScore also has a loop for adding moves itself (if it's needed, of course). If minScore cannot determine that the board is complete, that's when it adds another move for consideration. **Because minScore is thinking three moves ahead when it adds it's own move, minScore sends validBoard the computer's value instead of the human value. ** Why, you ask? If the computer can't go twice in the row, neither can the human. maxScore runs first and sends validBoard a possible move that the human could make. If it needs to predict the next move, it calls minScore (therefore thinking three moves ahead). Before we really dig deep into maxBoard and minBoard, I want to note the differences. **There are only three major differences between maxBoard and minBoard and they are absolutely crucial to making this work. We have already discussed one of the differences (what they send validBoard). ** The other differences are the most interesting and is the heart of the algorithm. Ready? If the board is incomplete, it's true that maxScore calls minScore. But here's the kicker, they will keep calling each other until one of them returns a value, whether it'd be a win situation, a tie, or a loss (represented in those nice numbers that we have them returning). So, let's imagine this conversation that maxScore and minScore are having. \\n\\n _(maxScore) - Hey, minScore, I can't figure this one out, even after I added another move. Help me?_ _(minScore) - I don't know man, it has to be a complete board. Otherwise, I'm just going to give you another possible move on top of the move that you added. If I do, I'm just going to send the board with my move back to you. _ _(maxScore) - I don't care, just give me something. I want this over with. _ So. What happens if maxScore is given a number (representing the outcome of such move)? maxScore has an arbitrary variable that is able to be rewritten (by using let or var). It is set to positive whatever, so long as it's bigger than any value that the others would return it. I chose 100\\\\. If the number that minScore gives maxScore is **smaller** than 100 (which it always will be the first round), it will **reassign the arbitrary variable with whatever number it is given.** This is important for the second/third round because it is testing for anything worse that minScore gave it. It returns that number no matter what it is at the end of the loops. If it can't find anything worse, so be it.\\n\\n _Hold on, what? Why would it rewrite on something smaller if it testing to win the game? I don't understand._ \\n\\n Remember that maxScore is the only function that talks to AIDecider? maxScore is looking for every reason to knock down minScore's ideas. So, if minScore gives maxScore a 10 initially, then runs another move that scores a 0 or -10, it will go back to AIDecider at the end of everything and tell AIDecider that this move in question isn't a good one. Likewise, if minScore gives maxScore a -10 initially and then gives it a 10, it will **still** go to AIDecider and tell it that the move in question isn't good. \\n\\n _What if maxScore returns to minScore with a value?_ \\n \\n It just returns the highest value to maxScore. Chances are that minScore will only run it's loop (and call maxScore) once or twice, and maxScore doesn't remember what it gives minScore. This means that minScore's arbitrary value is rewritten if maxScore gives it a higher number. Therefore, minScore's arbitrary number would have to be smaller than anything possible. I chose -100. Based on the first test of maxScore, we can imply that maxScore doesn't like calling minScore but has to when it is necessary. Maybe it doesn't trust minScore. Or maybe maxScore knows that the food blogger can be a jerk sometimes if the restaurant doesn't give him/her the best that they can offer. It doesn't matter. If minScore returns with a value, maxScore will then test to see if minScore gave it a worse value before. If not, it will return the value that minScore gave it. If so, it will return the worse value and make it AIDecider's problem to deal with. Recap (TL;DR): maxScore is the first test, and will add on it's own move and send the modified board to minScore if it needs to. minScore is the second test, and will add on another move and send it to maxScore, and so on until there are no more possible moves. The recursion belongs in both maxScore and minScore's else arguments in their if statements. So, after that lovely conversation with maxScore and minScore, maxScore finally returns with a value. AIDecider doesn't need to know what is happening back in the kitchen, and honestly it doesn't care. It's a mess of recursion back there anyways. It has it's own loop to deal with. AIDecider's arbitrary value is set to -100 like minScore and will change on anything that is more than that value. So if -100 rewrites to 0 (based on a tie that maxScore gave it), and on the next move, maxScore gives AIDecider a 10, it will rewrite that. \\n\\n _Side note- based on the logic of the arbitrary values, it means that the human is the **maximizing player **(meaning that this player is assumed to make the choice that will eventually lead to a win) and the computer is the **minimizing player **(meaning that this player is assumed to make a choice that will minimize the risk of a loss, even if that means blocking the other player from winning). maxScore guesses the best move that the maximizing player would (or should) make, and minScore guesses the best move that the minimizing player will make. For my game theory friends, you can read more about it by reading the Wikipedia article on the MiniMax algorithm found [here](https://en.wikipedia.org/wiki/Minimax)._ \\n\\n AIDecider remembers the index that it was on that gave it the highest value. It wants to pick a winner! So when maxScore and minScore are done fighting back there, AIDecider can finally return to board with an index that is associated with the highest value. At the end of the day, AIDecider runs setState on the board with the new move that maxScore and minScore chose added onto it. It also changes xIsNext while it's there, turning it over to the human. And that's it, folks. Hope you enjoyed my awesome lesson on game theory, and you know now the story of why it took me so long to figure this out (because math is hard, basically). \\n\\n Oh, and did I answer my question on why I think React is so popular? \\n\\n Remember that we made a clear button that erases the entire array? Well, React's special sauce is that it remembers the old state of the DOM and rewrites all that is changed. Example, if I only made two moves and the computer beats me, when I hit reset, it only changes the difference between the new array and the old. Why does that matter, you ask? It speeds up reload times 10 fold. Normally, it would erase the entire array and reload the board. Think of it like the difference between a sleeping lap cat and a cheetah chasing it's pray. Sure, both are cats and the cheetah is much more muscular and complicated, but the cheetah is much more faster and much more efficient than the sleeping lap cat. Although it is hard to see with this application because we only have two real components with three dummy components, it matters greatly when you have tens/hundreds of components that talk to each other. Imagine only like 5 of those components changing based on whatever. Only the parts of those 5 components changing will change. The rest of the tens/hundreds of components will remain unaffected. A good example of an application that needs this is my Twitch list ([https://robertspurlin.github.io/TwitchTV-Project/](https://robertspurlin.github.io/TwitchTV-Project/)). Notice how when you click a user's thumbnail, the whole array of users disappears and appears without the user in question.  Now, lets imagine if I wrote this in React. If you clicked on the thumbnail, React would only remove the user in question and leave the rest unaffected. Seems like a blessing in disguise to me. All that needs to be done is to actually get ahead of the learning curve... Until next time.\",\"data\":{\"title\":\"React, Tic-Tac-Toe, and Algorithms, oh my!\",\"thumbnail_path\":\"/images/blog/algorithm.jpeg\"},\"isEmpty\":false,\"excerpt\":\"\",\"path\":\"src/content/posts/2017-08-04-react-tic-tac-toe-algorithms-oh-my.md\"}]},\"path\":\"blog\",\"sharedData\":{},\"siteData\":{}}");</script><script defer="" type="text/javascript" src="/templates/styles.ac439c71.js"></script><script defer="" type="text/javascript" src="/templates/vendors~main.66236e5b.js"></script><script defer="" type="text/javascript" src="/main.8e8d98fc.js"></script></body></html>